<lifecycle name="PR">

  <summary>
    Creates the pull request and closes the beads ticket.
    All operations are delegated to sub-agents — the orchestrator never runs commands.
  </summary>

  <uses-behavior name="pr-template" />
  <uses-behavior name="human-gate" context="PR/PR_REVIEW" />
  <uses-behavior name="response-format" lifecycle="PR" />

  <loop>
    <!--
      PREPARE → HUMAN_GATE → SUBMIT → HANDOFF
                    │
                    │ rejected → PREPARE
                    └──────────┘
    -->

    <phase name="PREPARE" order="1">
      <actor>Orchestrator launches a PR Drafter agent (reasoning tier)</actor>
      <actions>
        <action>Compile all commits on the feature branch</action>
        <action>Review the full diff against main</action>
        <action>Draft the PR using the pr-template behavior</action>
      </actions>
      <on-success>Proceed to HUMAN_GATE</on-success>
      <on-failure>Stop and report failure to human</on-failure>
    </phase>

    <phase name="HUMAN_GATE" order="2">
      <actor>Orchestrator (reasoning tier)</actor>
      <actions>
        <action>Present draft PR for approval (see human-gate behavior, context: PR_REVIEW)</action>
      </actions>
      <on-success>Proceed to SUBMIT</on-success>
      <on-failure>Stop and report failure to human</on-failure>
      <on-rejection>Feed corrections back to PR Drafter → loop to PREPARE</on-rejection>
    </phase>

    <phase name="SUBMIT" order="3">
      <actor>Orchestrator launches a Submitter agent (light tier)</actor>
      <actions>
        <action>Push any remaining commits to remote (doc updates, beads changes)</action>
        <action>Create the PR via "gh pr create"</action>
        <action>
          Close the beads ticket with a close_reason summarizing what was done.
          TRUNK_BASED: close the single ticket.
          FEATURE_BRANCHING: close the epic ticket (all children should already be closed).
        </action>
        <action>Commit the beads closure on the branch before the PR merges</action>
        <action>Report the PR URL back to the orchestrator</action>
      </actions>
      <on-success>Proceed to HANDOFF</on-success>
      <on-failure>Stop and report failure to human</on-failure>
    </phase>

    <phase name="HANDOFF" order="4">
      <actor>Orchestrator (reasoning tier)</actor>
      <actions>
        <action>Ticket complete. PR created and ticket closed. Report PR URL to human.</action>
      </actions>
      <on-success>Lifecycle complete</on-success>
      <on-failure>Stop and report failure to human</on-failure>
    </phase>

  </loop>

</lifecycle>
